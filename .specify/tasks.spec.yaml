meta:
  id: rave-tasks
  title: Engineering Tasks (V3 - TDD)
  version: 3.0.0
  description: |
    Actionable tasks with traceability to specs and acceptance criteria expressed as tests.

tasks:
  - id: test-foundation
    module: Testing
    description: Set up Jest, ts-jest, Supertest, coverage thresholds, and CI workflow.
    related_spec: principles.spec.yaml#tdd
    acceptance_criteria:
      - jest.config.js present with threshold >=80%
      - CI workflow executes build and tests
      - Sample unit and API tests pass

  - id: cfg-schema-validation-tests
    module: Configuration
    description: Unit tests for config schema (valid/invalid), invariants, and seed option.
    related_spec: config.spec.yaml
    acceptance_criteria:
      - Invalid YAML triggers descriptive errors
      - Invariants enforced (probability, batch %, delay rules)
      - Seed parsed and exposed to simulator

  - id: sim-determinism-tests
    module: Simulation
    description: Unit tests ensuring deterministic outputs for identical seed + config + ticks.
    related_spec: simulation.spec.yaml#dynamics
    acceptance_criteria:
      - Same seed + config produces same sequence of form IDs/values
      - Visit delay/miss logic satisfies probability bounds

  - id: api-contract-tests
    module: API
    description: Supertest API tests for all endpoints (happy/error) using examples and schemas.
    related_spec: api.spec.yaml
    acceptance_criteria:
      - 200 responses match models
      - 400/422 on invalid inputs
      - Health endpoint returns 200 {status: "ok"}

  - id: coverage-gate
    module: Quality
    description: Enforce coverage in CI and report thresholds.
    related_spec: principles.spec.yaml#coverage
    acceptance_criteria:
      - Lines/branches >= 80% globally
      - CI fails if below thresholds
